<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gest√£o Studio Sa Lopes</title>

<!-- Tailwind CSS -->
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/main.global.min.js"></script>

<!-- Manifest (PWA) -->
<link rel="manifest" href="manifest.json">

<style>
  :root {
    --fundo: #1e1e1e;
    --rose: #f4bfae;
    --texto: #ffffff;
  }

  body {
    background-color: var(--fundo);
    color: var(--texto);
    font-family: 'Inter', sans-serif;
  }

  .sidebar {
    background-color: #111111;
    color: var(--rose);
    transition: transform 0.3s ease;
  }

  .sidebar a {
    display: block;
    padding: 12px 20px;
    border-radius: 8px;
    color: var(--rose);
    text-decoration: none;
    margin-bottom: 4px;
    transition: background 0.2s;
  }

  .sidebar a:hover, .sidebar a.active {
    background-color: var(--rose);
    color: #111111;
  }

  .sidebar.hidden { transform: translateX(-100%); }

  .card {
    background-color: #2b2b2b;
    color: var(--rose);
    border: 1px solid #3a3a3a;
  }

  .modal {
    display: none;
    position: fixed;
    z-index: 50;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center; align-items: center;
  }

  .modal-content {
    background: #2b2b2b;
    color: var(--rose);
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 800px;
    max-height: 90%;
    overflow-y: auto;
  }

  .btn-primary {
    background-color: var(--rose);
    color: #111;
    transition: all 0.3s ease;
  }

  .btn-primary:hover {
    background-color: #ffd2c2;
  }
</style>
</head>
<body class="flex h-screen">

<!-- Sidebar -->
<aside id="sidebar" class="sidebar w-64 p-5 flex flex-col fixed inset-y-0 left-0 z-40 hidden">
  <h1 class="text-2xl font-semibold mb-8 text-center">üíÖ Studio Sa Lopes</h1>
  <nav class="flex flex-col space-y-2">
    <a href="#" class="active" data-page="home">Home</a>
    <a href="#" data-page="clientes">Clientes</a>
    <a href="#" data-page="agenda">Agenda</a>
    <a href="#" data-page="financeiro">Financeiro</a>
  </nav>
</aside>

<!-- Bot√£o de menu -->
<button id="menuBtn" class="absolute top-5 left-5 p-2 rounded-md shadow-md z-50">
  <span style="color: var(--rose);" class="text-2xl">‚ò∞</span>
</button>

<!-- Conte√∫do principal -->
<main class="flex-1 p-10 overflow-y-auto ml-0 md:ml-64">

  <!-- HOME -->
  <div id="homePage" class="page">
    <div class="text-center mb-8">
      <img src="assets/logo.png" alt="Logo Studio Sa Lopes" class="mx-auto mb-4" style="width:320px;" onerror="this.onerror=null;this.src='https://via.placeholder.com/320x160?text=Logo';">
      <h2 class="text-3xl font-bold text-rose-300" style="display:none;">Gest√£o Studio Sa Lopes</h2>
    </div>

    <div class="grid grid-cols-3 gap-5 mb-5">
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="atendimentos">Atendimentos: 0</div>
      <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="agendamentos">Agendamentos: 0</div>
      <div class="card p-5 rounded-xl shadow grid grid-rows-2 text-center font-bold">
        <div id="primeiraVez">Primeira Vez: 0</div>
        <div id="manutencao">Manuten√ß√µes: 0</div>
      </div>
    </div>

    <div class="card rounded-xl shadow p-5 mb-5">
      <div id="calendar" class="w-full" style="height: 400px;"></div>
    </div>

    <div class="card rounded-xl shadow p-5 flex flex-col justify-center" id="resumoFinanceiro">
      <h3 class="text-lg font-bold mb-4">Resumo Financeiro do M√™s</h3>
      <div class="grid grid-cols-3 gap-5">
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoReceita">Receita: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoDespesa">Despesa: R$0</div>
        <div class="card p-5 rounded-xl shadow flex items-center justify-center font-bold text-lg" id="resumoSaldo">Saldo: R$0</div>
      </div>
    </div>
  </div>

  <!-- CLIENTES -->
  <div id="clientesPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Clientes</h2>
      <button id="btnAdicionarCliente" class="btn-primary px-4 py-2 rounded-md mr-4">Adicionar Cliente</button>
    </div>
  </div>

  <!-- AGENDA -->
  <div id="agendaPage" class="page hidden">
    <div class="flex justify-between mb-5 items-center">
      <h2 class="text-2xl font-bold text-rose-300 ml-4">Agenda</h2>
      <button id="btnAnamnese" class="btn-primary px-4 py-2 rounded-md mr-4">Adicionar Anamnese</button>
    </div>
    <div id="calendarAgenda" class="w-full" style="height: 600px;"></div>
    <!-- Modal Cadastro Anamnese -->
    <div id="modalAnamnese" class="modal flex">
      <div class="modal-content">
        <h2 class="text-2xl font-bold mb-4 text-rose-300">Cadastro de Anamnese</h2>
        <form id="formAnamnese" class="space-y-4">
          <div>
            <label class="block mb-1 font-semibold" for="anamneseNome">Nome</label>
            <input type="text" id="anamneseNome" name="nome" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="anamneseCpf">CPF</label>
            <input type="text" id="anamneseCpf" name="cpf" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="anamneseEndereco">Endere√ßo</label>
            <input type="text" id="anamneseEndereco" name="endereco" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div>
            <label class="block mb-1 font-semibold" for="anamneseTelefone">Telefone</label>
            <input type="text" id="anamneseTelefone" name="telefone" class="w-full p-2 rounded bg-[#1e1e1e] border border-rose-300 text-rose-300" required>
          </div>
          <div class="flex justify-end gap-3 mt-6">
            <button type="button" id="fecharModalAnamnese" class="btn-primary px-4 py-2 rounded-md">Fechar</button>
            <button type="submit" class="btn-primary px-4 py-2 rounded-md">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- FINANCEIRO -->
  <div id="financeiroPage" class="page hidden">
    <h2 class="text-2xl font-bold mb-5 text-rose-300 ml-4">Financeiro</h2>
  </div>
</main>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxpyfXV8w9bLT2QZJNSjHQyV0DKKAE4N4YJ3iZWBXQUlNY_BzvHSbCGvIlXyv2e1r2P/exec";

document.addEventListener("DOMContentLoaded", function() {
  const sidebar = document.getElementById("sidebar");
  const menuBtn = document.getElementById("menuBtn");
  menuBtn.addEventListener("click", function(e) {
    sidebar.classList.toggle("hidden");
    e.stopPropagation();
  });

  // Fecha o menu ao clicar fora da sidebar ou do bot√£o
  document.addEventListener("click", function(e) {
    if (!sidebar.classList.contains("hidden")) {
      const isClickInsideSidebar = sidebar.contains(e.target);
      const isClickOnMenuBtn = menuBtn.contains(e.target);
      if (!isClickInsideSidebar && !isClickOnMenuBtn) {
        sidebar.classList.add("hidden");
      }
    }
  });
  const pages = document.querySelectorAll(".page");
  document.querySelectorAll(".sidebar a").forEach(a=>{
    a.addEventListener("click", e=>{
      e.preventDefault();
      pages.forEach(p=>p.classList.add("hidden"));
      document.getElementById(a.dataset.page+"Page").classList.remove("hidden");
      document.querySelectorAll(".sidebar a").forEach(x=>x.classList.remove("active"));
      a.classList.add("active");
      if(a.dataset.page==="clientes") carregarClientes();
      if(a.dataset.page==="home") renderHomeCalendar();
    });
  });

  let homeCalendar;
  function renderHomeCalendar() {
    const calendarEl = document.getElementById("calendar");
    if (!calendarEl) return;
    if (homeCalendar) {
      homeCalendar.destroy();
    }
    homeCalendar = new FullCalendar.Calendar(calendarEl, {
      initialView: "dayGridMonth",
      dateClick: info => {
        const nome = prompt("Nome do Cliente:");
        if (nome) addAgendamento(info.dateStr, nome);
      }
    });
    homeCalendar.render();
  }
  renderHomeCalendar();

  const agendaCalendar = new FullCalendar.Calendar(document.getElementById("calendarAgenda"), {
    initialView:"dayGridMonth"
  });
  agendaCalendar.render();

  async function addAgendamento(data, cliente){
    const agendamento={tipo:"agendamento",data,hora:"09:00",cliente,servico:"C√≠lios"};
    await fetch(API_URL,{method:"POST",body:JSON.stringify(agendamento),headers:{"Content-Type":"application/json"}});
    alert("‚úÖ Agendamento salvo!");
    atualizarHome();
  }

  async function atualizarHome(){
    const res=await fetch(API_URL);
    const data=await res.json();
    document.getElementById("atendimentos").innerText=`Atendimentos: ${data.agendamentos?.length||0}`;
  }

  async function carregarClientes(){
    const res = await fetch(`${API_URL}?tipo=clientes`);
    const data = await res.json();
    const tabela = document.getElementById("listaClientes");
    tabela.innerHTML = "";
    data.forEach(cli=>{
      const linha = document.createElement("tr");
      linha.innerHTML = `
        <td class="p-2 text-left font-semibold">${cli.Nome||"-"}</td>
        <td class="p-2">${cli.Telefone||"-"}</td>
        <td class="p-2">${cli.Ultimo||"-"}</td>
        <td class="p-2">${cli.Proximo||"-"}</td>
        <td class="p-2 flex gap-3 justify-center">
          <span class="text-green-400 cursor-pointer" onclick="window.open('https://wa.me/55${cli.Telefone}','_blank')">üì±</span>
          <span class="text-blue-400 cursor-pointer" onclick="alert('Anamnese de ${cli.Nome}')">üìã</span>
          <span class="text-red-500 cursor-pointer" onclick="alert('Excluir ${cli.Nome}?')">üóëÔ∏è</span>
        </td>`;
      tabela.appendChild(linha);
    });
  }
});
</script>
</body>
</html>
